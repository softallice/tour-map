"use strict";(self["webpackChunkd3_map"]=self["webpackChunkd3_map"]||[]).push([[288],{5064:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var n=a(3673),r=a(2323);const l={class:"map-wrapper"},i={key:0,class:"province-title"},o={key:1,class:"province-info"},s={class:"text-center"},c=(0,n._)("svg",null,null,-1);function g(e,t,a,g,u,p){const d=(0,n.up)("q-img"),m=(0,n.up)("q-card"),h=(0,n.up)("UploadImages");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",l,[g.province?((0,n.wg)(),(0,n.iD)("h2",i,(0,r.zw)(g.province.state),1)):(0,n.kq)("",!0),g.currentProvince?((0,n.wg)(),(0,n.iD)("div",o,[(0,n._)("h3",s,(0,r.zw)(g.currentProvince.state),1),(0,n._)("ul",null,[(0,n._)("li",null,"지역: "+(0,r.zw)(g.currentProvince.SIG_KOR_NM),1),(0,n._)("li",null,"영문: "+(0,r.zw)(g.currentProvince.SIG_ENG_NM),1)]),(0,n.Wm)(m,{class:"my-card",flat:""},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{src:g.currentProvince.url},null,8,["src"])])),_:1})])):(0,n.kq)("",!0),c]),(0,n._)("div",null,[(0,n.Wm)(h,{refs:"uploadImage",onChanged:g.handleImages,max:10},null,8,["onChanged"])])],64)}a(71),a(5363);var u=a(1959),p=a(8728),d=a(651),m=(a(246),a(4550)),h=a(7880),f=a.n(h),v=a(284),w=a(52),y=a.n(w),I=a(82),_=a.n(I);let G=new v.Z("db");const k=async e=>{const t=await m.ZP.load(e),a=t["GPSLatitude"].description,n=t["GPSLongitude"].description,r={latitute:a,longitude:n};return r},N=(e,t,a)=>{for(let r=0;r<e.length;r++){var n=e[r].geometry.coordinates[0];if(f()([a,t],n))return e[r]}},S=(e,t)=>{let a=d.R2;for(let r=0;r<a.length;r++){var n=a[r].geometry.coordinates[0];if(f()([t,e],n))return a[r]}},P=(e,t,a)=>{for(let n=0;n<e.length;n++){let r=e[n].properties.SIG_ENG_NM,l=a.filter((e=>e.info.properties.SIG_ENG_NM===r))[0];l="undefined"==typeof l||null==l||""==l?"":l.image,t.append("pattern").attr("id",r.replace(", ","-")).attr("x","0").attr("y","0").attr("width","1").attr("height","1").append("image").attr("id","img"+r.replace(", ","-")).attr("xlink:href",l).attr("preserveAspectRatio","xMidYMid slice").attr("width","100").attr("height","100")}return t},b=async(e,t,a)=>{var n=new(_());n.append("uri",t);var r={method:"post",url:"http://172.27.42.125:3030/uploads",headers:{"Content-Type":"multipart/form-data"},data:n};let l;try{l=await y()(r),await M(e.name,l.data.id,a)}catch(i){console.log(i)}return l.data},M=async(e,t,a)=>{console.log("info",a);let n={name:e,url:t,info:a};var r={method:"post",url:"http://172.27.42.125:3030/image-map",headers:{"Content-Type":"application/json"},data:n};try{await y()(r)}catch(l){console.log("image url post fail")}},A=async()=>{var e="",t={method:"get",url:"http://172.27.42.125:3030/image-map",headers:{},data:e};let a=await y()(t);return a.data.data},C=async(e,t,a)=>{let n={id:e.name,image:t,info:a};await G.collection("images").add(n)},H=async e=>{let t;try{t=await G.collection("images").doc({name:e}).get()}catch(a){console.log("error",a)}return t},Z=async()=>{let e=await G.collection("images").get();return e},q={getImageLocation:N,getImageLoc:S,getImageGps:k,getSvgPattern:P,setImage:C,getImage:H,getImageAll:Z,setDbImage:b,getDbImage:A},x=q;var D=a(9518),E=a(8825);const L={name:"ImageMap",components:{UploadImages:D.Z},setup(){const e=(0,E.Z)(),t=()=>{let t=e.screen.width;return t},a=()=>{let t=e.screen.height-100;return t};let r=(0,u.iH)(null),l=(0,u.iH)(null);const i=(0,u.iH)(null),o=(0,u.iH)(null),s=(0,u.iH)("");let c,g,m,h,f=[],v=(0,u.iH)(null),w=null,y={lat:35.8,lng:127.689999},I={height:a(),width:t()},_=6500,G=p.scale.linear().domain([1,20]).clamp(!0).range(["#08304b","#08304b"]),k=p.geo.equirectangular().scale(_).center([y.lng,y.lat]).translate([I.width/2,I.height/2]),N=p.geo.path().projection(k);const S=e=>{let t=[...e];console.log(t),t.map((async e=>{P(e)}))},P=async e=>{let t=await x.getImageGps(e);console.log("imgGps ",t);let a=x.getImageLoc(t.latitute,t.longitude),n={latitute:t.latitute,longitude:t.longitude,properties:a.properties};a.image=e;let r=new FileReader;r.onload=async t=>{v.value=t.target.result,await x.setImage(e,v.value,n),f.push(a)},r.readAsDataURL(e)},b=e=>{e.value=e},M=e=>{let t=e.SIG_ENG_NM,a="#img"+t.replace(", ","-"),n=document.querySelector(a).getAttribute("href");e.url=n,l.value=e},A=()=>{l.value=""};(0,n.bv)((()=>{C()}));const C=async()=>{c=p.select("svg").attr("width",I.width).attr("height",I.height),c.append("defs");let e=await x.getImageAll();console.log("imageArray",e),c=x.getSvgPattern(d.R2,c,e),c.append("rect").attr("class","background").attr("width",I.width).attr("height",I.height).on("click",H),g=c.append("g"),m=g.append("g").classed("effect-layer",!0),h=g.append("g").classed("map-layer",!0);c.selectAll("pattern").data([0]);let t="js/korea-sgg.json";p.json(t,(function(e,t){var a=t.features;G.domain([0,p.max(a,D)]),h.selectAll("path").data(a).enter().append("path").attr("d",N).attr("vector-effect","non-scaling-stroke").style("fill",R).on("mouseover",Z).on("mouseout",q).on("click",H)}))};function H(e){var t,a,n;if(e&&w!==e){var r=N.centroid(e);t=r[0],a=r[1],n=4,w=e,M(e.properties)}else t=I.width/2,a=I.height/2,n=1,w=null,A();h.selectAll("path").style("fill",(function(e){return R(e)})),g.transition().duration(750).attr("transform","translate("+I.width/2+","+I.height/2+")scale("+n+")translate("+-t+","+-a+")")}function Z(e){let t=e.properties.SIG_ENG_NM,a=(t.replace(", ","-"),"url('#"+t.replace(", ","-")+"')");p.select(this).style("fill",a),e&&b(e.properties)}function q(e){}function D(e){const t=L(e);return t?t.length:0}function L(e){return e&&e.properties?e.properties.name:null}function R(e){let t=e.properties.SIG_ENG_NM,a="url('#"+t.replace(", ","-")+"')";return a}return{province:r,currentProvince:l,image:o,imageUrl:s,handleImages:S,uploadImage:i,rawImg:v}}};var R=a(4260),j=a(1543),z=a(4027),U=a(7518),W=a.n(U);const Q=(0,R.Z)(L,[["render",g]]),T=Q;W()(L,"components",{QCard:j.Z,QImg:z.Z})}}]);