"use strict";(self["webpackChunkd3_map"]=self["webpackChunkd3_map"]||[]).push([[891],{121:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var r=a(3673),n=a(2323);const l={class:"map-wrapper"},i={key:0,class:"province-title"},o={key:1,class:"province-info"},s={class:"text-center"},c=(0,r._)("svg",null,null,-1);function g(e,t,a,g,u,p){const d=(0,r.up)("q-img"),m=(0,r.up)("q-card"),h=(0,r.up)("UploadImages");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",l,[g.province?((0,r.wg)(),(0,r.iD)("h2",i,(0,n.zw)(g.province.state),1)):(0,r.kq)("",!0),g.currentProvince?((0,r.wg)(),(0,r.iD)("div",o,[(0,r._)("h3",s,(0,n.zw)(g.currentProvince.state),1),(0,r._)("ul",null,[(0,r._)("li",null,"지역: "+(0,n.zw)(g.currentProvince.SIG_KOR_NM),1),(0,r._)("li",null,"영문: "+(0,n.zw)(g.currentProvince.SIG_ENG_NM),1)]),(0,r.Wm)(m,{class:"my-card",flat:""},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{src:g.currentProvince.url},null,8,["src"])])),_:1})])):(0,r.kq)("",!0),c]),(0,r._)("div",null,[(0,r.Wm)(h,{refs:"uploadImage",onChanged:g.handleImages,max:10},null,8,["onChanged"])])],64)}a(71),a(5363);var u=a(1959),p=a(8728),d=a(651),m=(a(246),a(4550)),h=a(7880),f=a.n(h),v=a(284),w=a(4259),y=a(52),I=a.n(y),_=a(82),G=a.n(_);let b=new v.Z("db");const k=async e=>{const t=await m.ZP.load(e),a=t["GPSLatitude"].description,r=t["GPSLongitude"].description,n={latitute:a,longitude:r};return n},N=(e,t,a)=>{for(let n=0;n<e.length;n++){var r=e[n].geometry.coordinates[0];if(f()([a,t],r))return e[n]}},S=(e,t)=>{let a=d.R2;for(let n=0;n<a.length;n++){var r=a[n].geometry.coordinates[0];if(f()([t,e],r))return a[n]}},P=(e,t,a)=>{for(let r=0;r<e.length;r++){let n=e[r].properties.SIG_ENG_NM,l=a.filter((e=>e.info.properties.SIG_ENG_NM===n))[0];l="undefined"==typeof l||null==l||""==l?"":"http://172.27.42.125:3030/blobs/"+l.url,t.append("pattern").attr("id",n.replace(", ","-")).attr("x","0").attr("y","0").attr("width","1").attr("height","1").append("image").attr("id","img"+n.replace(", ","-")).attr("xlink:href",l).attr("preserveAspectRatio","xMidYMid slice").attr("width","100").attr("height","100")}return t},M=async(e,t,a)=>{var r=new(G());r.append("uri",t);var n={method:"post",url:"http://172.27.42.125:3030/uploads",headers:{"Content-Type":"multipart/form-data"},data:r};let l;try{l=await I()(n),await A(e.name,l.data.id,a)}catch(i){console.log(i)}return l.data},A=async(e,t,a)=>{console.log("info",a);let r={name:e,url:t,info:a};var n={method:"post",url:"http://172.27.42.125:3030/image-map",headers:{"Content-Type":"application/json"},data:r};try{await I()(n)}catch(l){console.log("image url post fail")}},D=async()=>{var e="",t={method:"get",url:"http://172.27.42.125:3030/image-map",headers:{},data:e};let a=await I()(t);return a.data.data},C=async(e,t)=>{let a=(0,w.Z)();console.log(" set image",e);let r={id:a,name:e,image:t};b.collection("images").add(r)},H=async e=>{let t;try{t=await b.collection("images").doc({name:e}).get()}catch(a){console.log("error",a)}return t},Z=async()=>{let e=await b.collection("images").get();return e},q={getImageLocation:N,getImageLoc:S,getImageGps:k,getSvgPattern:P,setImage:C,getImage:H,getImageAll:Z,setDbImage:M,getDbImage:D},x=q;var E=a(9518);const L={name:"ImageMap",components:{UploadImages:E.Z},setup(){let e=(0,u.iH)(null),t=(0,u.iH)(null);const a=(0,u.iH)(null),n=(0,u.iH)(null),l=(0,u.iH)("");let i,o,s,c,g=[],m=(0,u.iH)(null),h=null,f={lat:37,lng:126},v={height:700,width:1200},w=6500,y=p.scale.linear().domain([1,20]).clamp(!0).range(["#08304b","#08304b"]),I=p.geo.equirectangular().scale(w).center([f.lng,f.lat]).translate([v.width/2,v.height/2]),_=p.geo.path().projection(I);const G=e=>{let t=[...e];console.log(t),t.map((async e=>{b(e)}))},b=async e=>{let t=await x.getImageGps(e);console.log("imgGps ",t);let a=x.getImageLoc(t.latitute,t.longitude),r={latitute:t.latitute,longitude:t.longitude,properties:a.properties};a.image=e;let n=new FileReader;n.onload=async t=>{m.value=t.target.result;let n=await x.setDbImage(e,m.value,r);a.url=n.id,g.push(a)},n.readAsDataURL(e)},k=e=>{e.value=e},N=e=>{let a=e.SIG_ENG_NM,r="#img"+a.replace(", ","-"),n=document.querySelector(r).getAttribute("href");e.url=n,t.value=e},S=()=>{t.value=""};(0,r.bv)((()=>{P()}));const P=async()=>{i=p.select("svg").attr("width",v.width).attr("height",v.height),i.append("defs");let e=await x.getDbImage();console.log("imageArray",e),i=x.getSvgPattern(d.R2,i,e),i.append("rect").attr("class","background").attr("width",v.width).attr("height",v.height).on("click",M),o=i.append("g"),s=o.append("g").classed("effect-layer",!0),c=o.append("g").classed("map-layer",!0);i.selectAll("pattern").data([0]);let t="js/korea-sgg.json";p.json(t,(function(e,t){var a=t.features;y.domain([0,p.max(a,C)]),c.selectAll("path").data(a).enter().append("path").attr("d",_).attr("vector-effect","non-scaling-stroke").style("fill",Z).on("mouseover",A).on("mouseout",D).on("click",M)}))};function M(e){var t,a,r;if(e&&h!==e){var n=_.centroid(e);t=n[0],a=n[1],r=4,h=e,N(e.properties)}else t=v.width/2,a=v.height/2,r=1,h=null,S();c.selectAll("path").style("fill",(function(e){return Z(e)})),o.transition().duration(750).attr("transform","translate("+v.width/2+","+v.height/2+")scale("+r+")translate("+-t+","+-a+")")}function A(e){let t=e.properties.SIG_ENG_NM,a=(t.replace(", ","-"),"url('#"+t.replace(", ","-")+"')");p.select(this).style("fill",a),e&&k(e.properties)}function D(e){}function C(e){const t=H(e);return t?t.length:0}function H(e){return e&&e.properties?e.properties.name:null}function Z(e){let t=e.properties.SIG_ENG_NM,a="url('#"+t.replace(", ","-")+"')";return a}return{province:e,currentProvince:t,image:n,imageUrl:l,handleImages:G,uploadImage:a,rawImg:m}}};var R=a(4260),j=a(1543),z=a(4027),U=a(7518),W=a.n(U);const Q=(0,R.Z)(L,[["render",g]]),T=Q;W()(L,"components",{QCard:j.Z,QImg:z.Z})}}]);